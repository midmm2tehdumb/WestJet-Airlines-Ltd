<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lufthansa Airlines - Virtual Booking</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<nav>
    <div class="logo">Lufthansa Airlines</div>
    <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="fleet.html">Fleet</a></li>
        <li><a href="destinations.html">Destinations</a></li>
        <li><a href="booking.html">Booking</a></li>
        <li><a href="info.html">Information</a></li>
        <li><a href="rp.html">RP</a></li>
    </ul>
</nav>

<main>
    <h2 class="centered-heading">Booking Form</h2> 

    <div class="booking-form">
        <label for="departure">Departure Airport (3-Letter IATA):</label>
        <select id="departure">
            <option value="">-- Select Departure --</option>
        </select>

        <label for="arrival">Arrival Airport (3-Letter IATA):</label>
        <select id="arrival">
            <option value="">-- Select Arrival --</option>
        </select>

        <button onclick="calculateFlight()">Check Flight</button>
    </div>

    <div id="results"></div>

    <section class="disclaimer">
        <p>
            <strong>Disclaimer:</strong> Lufthansa Airlines is a virtual GeoFS airline and does not represent the real-life Lufthansa Group. 
            This website and content are intended for entertainment and educational purposes within the virtual flight simulator community.
        </p>
    </section>
</main>


<script>
    // --- START: AIRPORT DATA (Format: [Latitude, Longitude, UTC_Offset_Hours]) ---
    // NOTE: This uses standard offsets (excluding Daylight Saving Time changes) for simplicity.
    const airportCoords = {
        "FRA": [50.0379, 8.5622, 1], "MUC": [48.3538, 11.7861, 1], "ABV": [9.0060, 7.2636, 1], "AUH": [24.4321, 54.6516, 4],
        "ALC": [38.2822, -0.5581, 1], "ALG": [36.6911, 3.2158, 1], "ALA": [43.3521, 77.0403, 6], "AMM": [31.7226, 35.9935, 2],
        "AMS": [52.3086, 4.7639, 1], "AOI": [43.6169, 13.5189, 1], "ATH": [37.9364, 23.9445, 2], "ATL": [33.6407, -84.4279, -5],
        "OVD": [43.5631, -6.0346, 1], "GYD": [40.4675, 50.0469, 4], "BKK": [13.6811, 100.7472, 7], "BLR": [13.1979, 77.7063, 5.5],
        "BCN": [41.2974, 2.0833, 1], "BRI": [41.1388, 16.7600, 1], "BSL": [47.5931, 7.5297, 1], "BIA": [42.5522, 9.4831, 1],
        "PEK": [40.0801, 116.5846, 8], "BEY": [33.8886, 35.4955, 2], "BEG": [44.8186, 20.3092, 1], "BGO": [60.2931, 5.2189, 1],
        "BER": [52.3667, 13.5033, 1], "BIQ": [43.4681, -1.5316, 1], "BIO": [43.3013, -2.9100, 1], "BLL": [55.7401, 9.1517, 1],
        "BHX": [52.4530, -1.7480, 0], "BOG": [4.7016, -74.1469, -5], "BLQ": [44.5356, 11.2889, 1], "BOD": [44.8281, -0.7156, 1],
        "BOS": [42.3656, -71.0096, -5], "BRE": [53.0475, 8.7861, 1], "BDS": [40.6578, 17.9478, 1], "BRU": [50.9014, 4.4844, 1],
        "OTP": [44.5722, 26.1025, 2], "BUD": [47.4369, 19.2556, 1], "EZE": [-34.8222, -58.5358, -3], "BOJ": [42.5694, 27.5150, 2],
        "CAG": [39.2511, 9.0544, 1], "CAI": [30.1160, 31.4172, 2], "YYC": [51.1139, -114.0196, -7], "CPT": [-33.9700, 18.6021, 2],
        "CTA": [37.4661, 15.0650, 1], "CLT": [35.2140, -80.9431, -5], "MAA": [12.9949, 80.1690, 5.5], "ORD": [41.9742, -87.9073, -6],
        "CLJ": [46.7857, 23.6861, 2], "CGN": [50.8659, 7.1427, 1], "CPH": [55.6181, 12.6558, 1], "ORK": [51.8372, -8.4917, 0],
        "CFU": [39.6019, 19.9117, 2], "DFW": [32.8998, -97.0403, -6], "DMM": [26.4714, 50.1033, 3], "DEB": [47.3031, 21.6486, 1],
        "DEL": [28.5562, 77.1000, 5.5], "DEN": [39.8561, -104.6737, -7], "DTW": [42.2124, -83.3534, -5], "DRS": [51.1322, 13.7672, 1],
        "DUB": [53.4273, -6.2436, 0], "DXB": [25.2532, 55.3657, 4], "DBV": [42.5610, 18.2680, 1], "DUS": [51.2895, 6.7668, 1],
        "EDI": [55.9500, -3.3725, 0], "ERF": [51.8419, 11.0044, 1], "EBL": [36.2390, 43.9630, 3], "FAO": [37.0146, -7.9659, 0],
        "FLR": [43.8106, 11.2050, 1], "GDN": [54.3771, 18.4661, 1], "GVA": [46.2381, 6.1083, 1], "GLA": [55.8719, -4.4331, 0],
        "GOT": [57.6681, 11.7869, 1], "GRZ": [46.9914, 15.4390, 1], "HAM": [53.6300, 9.9880, 1], "HAJ": [52.4611, 9.6850, 1],
        "HEL": [60.3172, 24.9633, 2], "HER": [35.3397, 25.1808, 2], "HDF": [54.5803, 13.4089, 1], "HKG": [22.3080, 113.9185, 8],
        "IAH": [29.9844, -95.3414, -6], "HYD": [17.2313, 78.4294, 5.5], "IVL": [68.6071, 27.4058, 2], "IBZ": [38.8724, 1.3739, 1],
        "IST": [40.9769, 28.8146, 3], "ADB": [38.3206, 27.1561, 3], "JED": [21.6796, 39.1566, 3], "JNB": [-26.1392, 28.2460, 2],
        "KLX": [36.8617, 22.4992, 2], "FKB": [48.7800, 8.0800, 1], "KTW": [50.4744, 19.0800, 1], "EFL": [38.1206, 20.5000, 2],
        "KTT": [67.7003, 24.8500, 2], "KGS": [36.8917, 27.2883, 2], "KRK": [50.0777, 19.7846, 1], "KAO": [65.9800, 29.2300, 3],
        "KWI": [29.2266, 47.9689, 3], "LOS": [6.5773, 3.3212, 1], "SUF": [38.9006, 16.2425, 1], "LCA": [34.8756, 33.6244, 2],
        "LEJ": [51.4231, 12.2367, 1], "LIS": [38.7712, -9.1342, 0], "LNZ": [48.2339, 14.1878, 1], "LHR": [51.4700, -0.4543, 0],
        "STN": [51.8890, 0.2330, 0], "LAX": [33.9425, -118.4081, -8], "LAD": [-8.8368, 13.2317, 1], "LUX": [49.6266, 6.2110, 1],
        "LYS": [45.7256, 5.0811, 1], "MAD": [40.4719, -3.5626, 1], "SSG": [3.7500, 8.7833, 1], "AGP": [36.6749, -4.4991, 1],
        "MLA": [35.8575, 14.4775, 1], "MAN": [53.3650, -2.2725, 0], "MRS": [43.4372, 5.2140, 1], "MEX": [19.4361, -99.0719, -6],
        "MIA": [25.7959, -80.2871, -5], "LIN": [45.4450, 9.2769, 1], "MXP": [45.6306, 8.7231, 1], "MSP": [44.8848, -93.2223, -6],
        "YUL": [45.4576, -73.7492, -5], "BOM": [19.0896, 72.8656, 5.5], "FMO": [52.1347, 7.6856, 1], "JMK": [36.3969, 25.4294, 2],
        "NBO": [-1.3192, 36.9275, 3], "NTE": [47.1539, -1.6111, 1], "NAP": [40.8860, 14.2906, 1], "NCL": [55.0375, -1.6917, 0],
        "JFK": [40.6413, -73.7781, -5], "EWR": [40.6895, -74.1745, -5], "NCE": [43.6584, 7.2159, 1], "NUE": [49.4987, 11.0784, 1],
        "OLB": [40.9022, 9.5172, 1], "KIX": [34.4347, 135.2441, 9], "OSL": [60.1939, 11.1004, 1], "PMO": [38.1758, 13.0914, 1],
        "PMI": [39.5519, 2.7386, 1], "PTY": [8.9533, -79.5558, -5], "PFO": [34.7150, 32.4850, 2], "CDG": [49.0097, 2.5479, 1],
        "PHL": [39.8719, -75.2411, -5], "PHC": [4.9350, 7.0131, 1], "OPO": [41.2481, -8.6819, 0], "POZ": [52.4214, 16.8261, 1],
        "PRG": [50.1008, 14.2710, 1], "PUY": [44.8936, 13.9189, 1], "RDU": [35.8776, -78.7875, -5], "KEF": [63.9850, -22.6056, 0],
        "RHO": [36.4347, 28.2178, 2], "RIX": [56.9225, 24.0831, 2], "RJK": [45.2167, 14.5708, 1], "GIG": [-22.8090, -43.2506, -3],
        "RUH": [24.9570, 46.6985, 3], "FCO": [41.7999, 12.2462, 1], "RVN": [66.3625, 25.8300, 2], "SZG": [47.7939, 13.0042, 1],
        "SFO": [37.6189, -122.3750, -8], "SJO": [9.9939, -84.2086, -6], "SJC": [37.3626, -121.9290, -8], "JTR": [36.3991, 25.4794, 2],
        "SCQ": [42.8961, -8.4150, 1], "SJJ": [43.8247, 18.3311, 1], "GRU": [-23.4356, -46.4731, -3], "SEA": [47.4489, -122.3090, -8],
        "ICN": [37.4602, 126.4407, 9], "SVQ": [37.4192, -5.9003, 1], "PVG": [31.1443, 121.8083, 8], "SIN": [1.3592, 103.9894, 8],
        "SOF": [42.6950, 23.4060, 2], "SPU": [43.5386, 16.2986, 1], "SVG": [58.8761, 5.6375, 1], "STL": [38.7487, -90.3700, -6],
        "ARN": [59.6519, 17.9186, 1], "SXB": [48.5383, 7.6283, 1], "STR": [48.6897, 9.2219, 1], "TLL": [59.4133, 24.8322, 2],
        "IKA": [35.4161, 51.1522, 3.5], "TLV": [32.0114, 34.8866, 2], "SKG": [40.5181, 22.9747, 2], "TIA": [41.4142, 19.7204, 1],
        "TIV": [42.4042, 18.7233, 1], "HND": [35.5494, 139.7798, 9], "YYZ": [43.6777, -79.6248, -5], "TOS": [69.6828, 18.9181, 1],
        "TRD": [63.4571, 10.9241, 1], "TUN": [36.8510, 10.2273, 1], "VLC": [39.4897, -0.4819, 1], "YVR": [49.1936, -123.1836, -8],
        "VAR": [43.2076, 27.8251, 2], "VCE": [45.5052, 12.3519, 1], "VIE": [48.1103, 16.5697, 1], "VNO": [54.6740, 25.2854, 2],
        "WAW": [52.1657, 20.9671, 1], "IAD": [38.9444, -77.4558, -5], "GWT": [54.9136, 8.3475, 1], "WRO": [51.1020, 17.0304, 1],
        "WBG": [49.8106, 9.9425, 1], "ZAD": [44.1086, 15.3467, 1], "ZAG": [45.7420, 16.0680, 1], "ZTH": [37.7500, 20.8842, 2],
        "ZRH": [47.4581, 8.5492, 1], 
        "PER": [-31.9385, 115.9672, 8] // The third value (8) is the UTC offset
    };
    // --- END: AIRPORT DATA ---


    const departureSelect = document.getElementById('departure');
    const arrivalSelect = document.getElementById('arrival');
    
    // Function to populate dropdowns (Unchanged)
    function populateAirports() {
        departureSelect.innerHTML = '<option value="">-- Select Departure --</option>';
        arrivalSelect.innerHTML = '<option value="">-- Select Arrival --</option>';
        
        // Sorting is still based on the IATA code (key)
        Object.keys(airportCoords).sort().forEach(code => {
            const option1 = document.createElement('option');
            option1.value = code;
            option1.textContent = code;
            departureSelect.appendChild(option1);

            const option2 = document.createElement('option');
            option2.value = code;
            option2.textContent = code;
            arrivalSelect.appendChild(option2);
        });
    }

    // Call the function to populate the dropdowns immediately on page load
    populateAirports();


    // Haversine formula to calculate distance (Unchanged)
    function getDistance(coord1, coord2) {
        const R = 6371; // km (Earth radius)
        const dLat = (coord2[0] - coord1[0]) * Math.PI / 180;
        const dLon = (coord2[1] - coord1[1]) * Math.PI / 180;
        const a = Math.sin(dLat / 2) ** 2 + Math.cos(coord1[0] * Math.PI / 180) * Math.cos(coord2[0] * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        // coord1[0] is Latitude, coord2[1] is Longitude
        return R * c;
    }

    // Suggest plane based on distance (Lufthansa fleet - Unchanged)
    function suggestPlane(distance) {
        if(distance < 1000) return "CRJ-700 / A319 / A320 / A321";
        if(distance < 4000) return "A319 / A320 / A321 / A330";
        if(distance < 8000) return "A330 / A340 / A350 / 787";
        if(distance < 12000) return "A330 / A350 / 747 / 777 / 787";
        if(distance < 13000) return "A350 / 747 / 777 / A380";
        if(distance < 15500) return "A350-1000XWB (310 Seat Config)";
        return "Too far. Choose another route.";
    }

    // Estimate flight time with enhanced ground/low-altitude padding for short-haul realism (LOGIC CORRECT)
    function estimateTime(distance, depCoord, arrCoord, plane) {
        // --- Configuration Constants ---
        const R_KTS_TO_KMH = 1.852; 
        const R_FT_TO_KM = 0.0003048;

        // --- REALISM FACTORS ---
        const ADDED_TIME_FOR_LOW_SPEED = 0.3; // 18 minutes fixed buffer
        
        // 1. ROUTING FACTOR: Accounts for non-Great Circle routing (Airways, ATC, etc.)
        const ROUTING_FACTOR_LONG_HAUL = 1.08; 
        const ROUTING_FACTOR_SHORT_HAUL = 1.15; 
        
        let adjustedDistance;

        // Determine the general direction based on longitude change
        const lonDifference = depCoord[1] - arrCoord[1];
        const isWestbound = lonDifference > 0; 
        const isEastbound = lonDifference < 0; 
        
        let WIND_FACTOR = 1.0; 
        
        // Check if it's a long haul flight (greater than ~4500 km)
        if (distance > 4500) { 
            adjustedDistance = distance * ROUTING_FACTOR_LONG_HAUL;
            
            // 2. WIND FACTOR (Long Haul)
            if (isWestbound && Math.abs(lonDifference) > 10) { 
                WIND_FACTOR = 1.08; // Headwind penalty
            } else if (isEastbound && Math.abs(lonDifference) > 10) {
                WIND_FACTOR = 0.94; // Tailwind benefit
            } else { 
                WIND_FACTOR = 1.02; // North/South minor penalty
            }
            
        } else {
            // --- SHORT HAUL LOGIC (Less than ~4500 km) ---
            adjustedDistance = distance * ROUTING_FACTOR_SHORT_HAUL;
        }

        // Phase 2: Cruise Speed & Altitude
        let cruiseSpeed = 820; // default km/h (short/medium haul)
        let cruiseAltitude = 7; // default 7km (FL230)
        
        if (adjustedDistance > 4500) { 
            cruiseSpeed = 870; 
            cruiseAltitude = 11; // 11km (FL360)
        }

        // --- Calculation ---
        const ALTITUDE_5K_KM = 5000 * R_FT_TO_KM; 
        const SPEED_BELOW_5K_KMH = 350 * R_KTS_TO_KMH; 
        const CLIMB_RATE_KMH = (1000 * R_FT_TO_KM) * 60; 
        const DESCENT_RATE_KMH = (1500 * R_FT_TO_KM) * 60; 
        const AVG_DESCENT_SPEED_KMH = 550; 
        const AVG_CLIMB_ABOVE_5K_KMH = 650; 

        // 1. CLIMB (Split based on 5km transition)
        const timeTo5K = ALTITUDE_5K_KM / CLIMB_RATE_KMH;
        const distTo5K = timeTo5K * SPEED_BELOW_5K_KMH;

        const remainingClimbAlt = Math.max(0, cruiseAltitude - ALTITUDE_5K_KM);
        const timeAbove5K = remainingClimbAlt / CLIMB_RATE_KMH;
        const distAbove5K = timeAbove5K * AVG_CLIMB_ABOVE_5K_KMH;

        const totalClimbTime = timeTo5K + timeAbove5K;
        const totalClimbDist = distTo5K + distAbove5K;

        // 2. DESCENT
        const totalDescentTime = cruiseAltitude / DESCENT_RATE_KMH;
        const totalDescentDist = totalDescentTime * AVG_DESCENT_SPEED_KMH;

        // 3. CRUISE
        const cruiseDist = adjustedDistance - totalClimbDist - totalDescentDist;
        let cruiseTime = 0;

        if (cruiseDist > 0) {
            cruiseTime = cruiseDist / cruiseSpeed;
        } else {
            // Very short flight (less distance than climb/descent profiles): simple average speed
            const avgSpeed = (SPEED_BELOW_5K_KMH + cruiseSpeed) / 2;
            let time = (adjustedDistance / avgSpeed) + ADDED_TIME_FOR_LOW_SPEED;
            return time * WIND_FACTOR;
        }

        // 4. TOTAL TIME
        let finalTime = totalClimbTime + cruiseTime + totalDescentTime + ADDED_TIME_FOR_LOW_SPEED;
        
        return finalTime * WIND_FACTOR;
    }

    // Helper to format hours/minutes from a Date object for display
    function formatTime(date) {
        // Use your browser's local time formatting
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    // Helper to format UTC time from a Date object
    function formatUTC(date) {
        const hours = ('0' + date.getUTCHours()).slice(-2);
        const minutes = ('0' + date.getUTCMinutes()).slice(-2);
        return `${hours}:${minutes} UTC`;
    }

    // Core function to calculate and display flight details
    function calculateFlight() {
        const dep = departureSelect.value;
        const arr = arrivalSelect.value;
        
        if(!dep || !arr) {
            alert("Please select both airports!");
            return;
        }
        if(dep === arr) {
            alert("Departure and arrival cannot be the same!");
            return;
        }
        
        const depData = airportCoords[dep];
        const arrData = airportCoords[arr];

        if (!depData || !arrData) {
            alert("Airport coordinates/data missing for one or both selections.");
            return;
        }
        
        // Extract Coordinates and UTC Offsets from the new data structure
        const depCoord = [depData[0], depData[1]]; // [Lat, Lon]
        const arrCoord = [arrData[0], arrData[1]]; // [Lat, Lon]
        const depUTC = depData[2]; // Departure UTC Offset in Hours
        const arrUTC = arrData[2]; // Arrival UTC Offset in Hours


        const distance = getDistance(depCoord, arrCoord);
        const plane = suggestPlane(distance);
        
        if (plane.includes("Too far")) {
            document.getElementById('results').innerHTML = `<p><strong>Error:</strong> ${plane}</p>`;
            return;
        }

        const flightHours = estimateTime(distance, depCoord, arrCoord, plane);
        
        // --- TIME CALCULATIONS ---
        
        // 1. Current UTC Time (Start time for the simulation)
        const nowUTC = new Date(Date.now()); 
        
        // 2. Departure Time (Departure Airport Local Time)
        // Adjust the UTC time by the departure airport's UTC offset
        const departureLocalHours = nowUTC.getUTCHours() + depUTC;
        const departureLocal = new Date(nowUTC);
        departureLocal.setHours(departureLocal.getHours() + depUTC - departureLocal.getTimezoneOffset() / 60);

        // 3. Arrival Time (UTC)
        const arrivalUTCMs = nowUTC.getTime() + (flightHours * 3600000);
        const arrivalUTC = new Date(arrivalUTCMs);

        // 4. Arrival Time (Destination Airport Local Time)
        // Adjust the final UTC arrival time by the arrival airport's UTC offset
        const arrivalLocalHours = arrivalUTC.getUTCHours() + arrUTC;
        const arrivalLocalDestination = new Date(arrivalUTC);
        arrivalLocalDestination.setHours(arrivalLocalDestination.getHours() + arrUTC - arrivalLocalDestination.getTimezoneOffset() / 60);

        // --- Output results --- 
        document.getElementById('results').innerHTML = `
            <h3>Flight Details</h3>
            <p>Route Distance (Great Circle): <strong>${distance.toFixed(1)} km</strong></p>
            <p>Suggested Aircraft: <strong>${plane}</strong></p>
            <p>Estimated Flight Time: <strong>~${Math.floor(flightHours)}h ${Math.round((flightHours % 1) * 60)}m</strong></p>
            <hr>
            <h4>Estimated Departure/Arrival (Simulated)</h4>
            <p>Takeoff (Departure Local Time, UTC ${depUTC > 0 ? '+' : ''}${depUTC}): <strong>${formatTime(departureLocal)}</strong></p>
            <p>Landing (Destination Local Time, UTC ${arrUTC > 0 ? '+' : ''}${arrUTC}): <strong>${formatTime(arrivalLocalDestination)}</strong></p>
            <p>Takeoff (UTC): <strong>${formatUTC(nowUTC)}</strong></p>
            <p>Landing (UTC): <strong>${formatUTC(arrivalUTC)}</strong></p>
        `;
    }
</script>

</body>
</html>
